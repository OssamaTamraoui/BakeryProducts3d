{"ast":null,"code":"import { EffectComposer, RenderPass, VignetteEffect, BrightnessContrastEffect, GammaCorrectionEffect, SMAAEffect, BloomEffect, HueSaturationEffect, NormalPass, DepthDownsamplingPass, SSAOEffect, TextureEffect, EffectPass, SMAAPreset, EdgeDetectionMode, BlendFunction, KernelSize, PredicationMode, ShaderPass } from \"postprocessing\";\nimport { CopyMaterial } from \"./CopyMaterial\";\nimport { FloatType, HalfFloatType } from \"three\";\n\nfunction Composer(renderer, scene, camera, smaaSearchImage, smaaAreaImage) {\n  const composer = new EffectComposer(renderer, {\n    frameBufferType: HalfFloatType\n  });\n  const renderPass = new RenderPass(scene, camera);\n  composer.addPass(renderPass);\n  const vignetteEffect = new VignetteEffect({\n    eskil: false,\n    offset: 0.1,\n    darkness: 0.5\n  });\n  const brightnessContrastEffect = new BrightnessContrastEffect({\n    contrast: 0.05,\n    brightness: 0.0\n  });\n  const gammaCorrectionEffect = new GammaCorrectionEffect({\n    gamma: 1.6\n  });\n  const smaaEffect = new SMAAEffect(smaaSearchImage, smaaAreaImage, SMAAPreset.HIGH, EdgeDetectionMode.COLOR);\n  smaaEffect.edgeDetectionMaterial.setEdgeDetectionThreshold(0.05);\n  smaaEffect.edgeDetectionMaterial.setPredicationMode(PredicationMode.DEPTH);\n  smaaEffect.edgeDetectionMaterial.setPredicationThreshold(0.002);\n  smaaEffect.edgeDetectionMaterial.setPredicationScale(1.0);\n  const edgesTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetEdges.texture\n  });\n  const weightsTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetWeights.texture\n  });\n  const bloomEffect = new BloomEffect({\n    blendFunction: BlendFunction.SCREEN,\n    kernelSize: KernelSize.MEDIUM,\n    luminanceThreshold: 0.3,\n    luminanceSmoothing: 0.83,\n    height: 1024,\n    intensity: 0.5,\n    resolutionScale: 0.5\n  });\n  const hueSaturationEffect = new HueSaturationEffect({\n    hue: 0.0,\n    saturation: 0.191\n  });\n  const normalPass = new NormalPass(scene, camera);\n  const depthDownsamplingPass = new DepthDownsamplingPass({\n    normalBuffer: normalPass.texture,\n    resolutionScale: 0.5\n  });\n  const normalDepthBuffer = renderer.capabilities.isWebGL2 ? depthDownsamplingPass.texture : null; // Note: Thresholds and falloff correspond to camera near/far.\n  // Example: worldDistance = distanceThreshold * (camera.far - camera.near)\n\n  const ssaoEffect = new SSAOEffect(camera, normalPass.texture, {\n    blendFunction: BlendFunction.MULTIPLY,\n    distanceScaling: true,\n    depthAwareUpsampling: true,\n    normalDepthBuffer,\n    samples: 9,\n    rings: 7,\n    distanceThreshold: 0.02,\n    // Render up to a distance of ~20 world units\n    distanceFalloff: 0.0025,\n    // with an additional ~2.5 units of falloff.\n    rangeThreshold: 0.0003,\n    // Occlusion proximity of ~0.3 world units\n    rangeFalloff: 0.0001,\n    // with ~0.1 units of falloff.\n    luminanceInfluence: 0.7,\n    minRadiusScale: 0.33,\n    radius: 0.1,\n    intensity: 1.33,\n    bias: 0.025,\n    fade: 0.01,\n    color: null,\n    resolutionScale: 1\n  });\n  const copyPass = new ShaderPass(new CopyMaterial());\n  const effectPass = new EffectPass(camera, bloomEffect, smaaEffect, edgesTextureEffect, weightsTextureEffect, ssaoEffect, vignetteEffect, brightnessContrastEffect, gammaCorrectionEffect, hueSaturationEffect);\n  composer.addPass(normalPass);\n\n  if (renderer.capabilities.isWebGL2) {\n    composer.addPass(depthDownsamplingPass);\n  } else {\n    console.log(\"WebGL 2 not supported, falling back to naive depth downsampling\");\n  }\n\n  copyPass.enabled = false;\n  copyPass.renderToScreen = true;\n  effectPass.renderToScreen = true;\n  composer.addPass(copyPass);\n  composer.addPass(effectPass);\n  return composer;\n}\n\n_c = Composer;\nexport default Composer;\n\nvar _c;\n\n$RefreshReg$(_c, \"Composer\");","map":{"version":3,"names":["EffectComposer","RenderPass","VignetteEffect","BrightnessContrastEffect","GammaCorrectionEffect","SMAAEffect","BloomEffect","HueSaturationEffect","NormalPass","DepthDownsamplingPass","SSAOEffect","TextureEffect","EffectPass","SMAAPreset","EdgeDetectionMode","BlendFunction","KernelSize","PredicationMode","ShaderPass","CopyMaterial","FloatType","HalfFloatType","Composer","renderer","scene","camera","smaaSearchImage","smaaAreaImage","composer","frameBufferType","renderPass","addPass","vignetteEffect","eskil","offset","darkness","brightnessContrastEffect","contrast","brightness","gammaCorrectionEffect","gamma","smaaEffect","HIGH","COLOR","edgeDetectionMaterial","setEdgeDetectionThreshold","setPredicationMode","DEPTH","setPredicationThreshold","setPredicationScale","edgesTextureEffect","blendFunction","SKIP","texture","renderTargetEdges","weightsTextureEffect","renderTargetWeights","bloomEffect","SCREEN","kernelSize","MEDIUM","luminanceThreshold","luminanceSmoothing","height","intensity","resolutionScale","hueSaturationEffect","hue","saturation","normalPass","depthDownsamplingPass","normalBuffer","normalDepthBuffer","capabilities","isWebGL2","ssaoEffect","MULTIPLY","distanceScaling","depthAwareUpsampling","samples","rings","distanceThreshold","distanceFalloff","rangeThreshold","rangeFalloff","luminanceInfluence","minRadiusScale","radius","bias","fade","color","copyPass","effectPass","console","log","enabled","renderToScreen"],"sources":["/Users/sam/Documents/CakeProject/src/components/Viewer3D/libs/Composer.js"],"sourcesContent":["import {\n  EffectComposer,\n  RenderPass,\n  VignetteEffect,\n  BrightnessContrastEffect,\n  GammaCorrectionEffect,\n  SMAAEffect,\n  BloomEffect,\n  HueSaturationEffect,\n  NormalPass,\n  DepthDownsamplingPass,\n  SSAOEffect,\n  TextureEffect,\n  EffectPass,\n  SMAAPreset,\n  EdgeDetectionMode,\n  BlendFunction,\n  KernelSize,\n  PredicationMode,\n  ShaderPass\n} from \"postprocessing\"\n\nimport {CopyMaterial} from \"./CopyMaterial\"\n\nimport {FloatType, HalfFloatType} from \"three\"\n\nfunction Composer(renderer, scene, camera, smaaSearchImage, smaaAreaImage) {\n  const composer = new EffectComposer(renderer, {\n    frameBufferType: HalfFloatType\n  })\n  const renderPass = new RenderPass(scene, camera)\n  composer.addPass(renderPass)\n  const vignetteEffect = new VignetteEffect({\n    eskil: false,\n    offset: 0.1,\n    darkness: 0.5\n  })\n  const brightnessContrastEffect = new BrightnessContrastEffect({\n    contrast: 0.05,\n    brightness: 0.0\n  })\n  const gammaCorrectionEffect = new GammaCorrectionEffect({\n    gamma: 1.6\n  })\n\n  const smaaEffect = new SMAAEffect(\n    smaaSearchImage,\n    smaaAreaImage,\n    SMAAPreset.HIGH,\n    EdgeDetectionMode.COLOR\n  )\n  smaaEffect.edgeDetectionMaterial.setEdgeDetectionThreshold(0.05)\n  smaaEffect.edgeDetectionMaterial.setPredicationMode(PredicationMode.DEPTH)\n  smaaEffect.edgeDetectionMaterial.setPredicationThreshold(0.002)\n  smaaEffect.edgeDetectionMaterial.setPredicationScale(1.0)\n\n  const edgesTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetEdges.texture\n  })\n\n  const weightsTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetWeights.texture\n  })\n\n  const bloomEffect = new BloomEffect({\n    blendFunction: BlendFunction.SCREEN,\n    kernelSize: KernelSize.MEDIUM,\n    luminanceThreshold: 0.3,\n    luminanceSmoothing: 0.83,\n    height: 1024,\n    intensity: 0.5,\n    resolutionScale: 0.5\n  })\n\n  const hueSaturationEffect = new HueSaturationEffect({\n    hue: 0.0,\n    saturation: 0.191\n  })\n\n  const normalPass = new NormalPass(scene, camera)\n  const depthDownsamplingPass = new DepthDownsamplingPass({\n    normalBuffer: normalPass.texture,\n    resolutionScale: 0.5\n  })\n  const normalDepthBuffer = renderer.capabilities.isWebGL2\n    ? depthDownsamplingPass.texture\n    : null\n\n  // Note: Thresholds and falloff correspond to camera near/far.\n  // Example: worldDistance = distanceThreshold * (camera.far - camera.near)\n  const ssaoEffect = new SSAOEffect(camera, normalPass.texture, {\n    blendFunction: BlendFunction.MULTIPLY,\n    distanceScaling: true,\n    depthAwareUpsampling: true,\n    normalDepthBuffer,\n    samples: 9,\n    rings: 7,\n    distanceThreshold: 0.02, // Render up to a distance of ~20 world units\n    distanceFalloff: 0.0025, // with an additional ~2.5 units of falloff.\n    rangeThreshold: 0.0003, // Occlusion proximity of ~0.3 world units\n    rangeFalloff: 0.0001, // with ~0.1 units of falloff.\n    luminanceInfluence: 0.7,\n    minRadiusScale: 0.33,\n    radius: 0.1,\n    intensity: 1.33,\n    bias: 0.025,\n    fade: 0.01,\n    color: null,\n    resolutionScale: 1\n  })\n\n  const copyPass = new ShaderPass(new CopyMaterial())\n\n  const effectPass = new EffectPass(\n    camera,\n    bloomEffect,\n    smaaEffect,\n    edgesTextureEffect,\n    weightsTextureEffect,\n    ssaoEffect,\n    vignetteEffect,\n    brightnessContrastEffect,\n    gammaCorrectionEffect,\n    hueSaturationEffect\n  )\n\n  composer.addPass(normalPass)\n  if (renderer.capabilities.isWebGL2) {\n    composer.addPass(depthDownsamplingPass)\n  } else {\n    console.log(\n      \"WebGL 2 not supported, falling back to naive depth downsampling\"\n    )\n  }\n\n  copyPass.enabled = false\n  copyPass.renderToScreen = true\n  effectPass.renderToScreen = true\n\n  composer.addPass(copyPass)\n  composer.addPass(effectPass)\n\n  return composer\n}\n\nexport default Composer\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}