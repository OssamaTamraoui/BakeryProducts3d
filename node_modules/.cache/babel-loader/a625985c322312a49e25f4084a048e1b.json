{"ast":null,"code":"import{EffectComposer,RenderPass,VignetteEffect,BrightnessContrastEffect,GammaCorrectionEffect,SMAAEffect,BloomEffect,HueSaturationEffect,NormalPass,DepthDownsamplingPass,SSAOEffect,TextureEffect,EffectPass,SMAAPreset,EdgeDetectionMode,BlendFunction,KernelSize,PredicationMode,ShaderPass}from\"postprocessing\";import{CopyMaterial}from\"./CopyMaterial\";import{FloatType,HalfFloatType}from\"three\";function Composer(renderer,scene,camera,smaaSearchImage,smaaAreaImage){const composer=new EffectComposer(renderer,{frameBufferType:HalfFloatType});const renderPass=new RenderPass(scene,camera);composer.addPass(renderPass);const vignetteEffect=new VignetteEffect({eskil:false,offset:0.1,darkness:0.5});const brightnessContrastEffect=new BrightnessContrastEffect({contrast:0.05,brightness:0.0});const gammaCorrectionEffect=new GammaCorrectionEffect({gamma:1.6});const smaaEffect=new SMAAEffect(smaaSearchImage,smaaAreaImage,SMAAPreset.HIGH,EdgeDetectionMode.COLOR);smaaEffect.edgeDetectionMaterial.setEdgeDetectionThreshold(0.05);smaaEffect.edgeDetectionMaterial.setPredicationMode(PredicationMode.DEPTH);smaaEffect.edgeDetectionMaterial.setPredicationThreshold(0.002);smaaEffect.edgeDetectionMaterial.setPredicationScale(1.0);const edgesTextureEffect=new TextureEffect({blendFunction:BlendFunction.SKIP,texture:smaaEffect.renderTargetEdges.texture});const weightsTextureEffect=new TextureEffect({blendFunction:BlendFunction.SKIP,texture:smaaEffect.renderTargetWeights.texture});const bloomEffect=new BloomEffect({blendFunction:BlendFunction.SCREEN,kernelSize:KernelSize.MEDIUM,luminanceThreshold:0.3,luminanceSmoothing:0.83,height:1024,intensity:0.5,resolutionScale:0.5});const hueSaturationEffect=new HueSaturationEffect({hue:0.0,saturation:0.191});const normalPass=new NormalPass(scene,camera);const depthDownsamplingPass=new DepthDownsamplingPass({normalBuffer:normalPass.texture,resolutionScale:0.5});const normalDepthBuffer=renderer.capabilities.isWebGL2?depthDownsamplingPass.texture:null;// Note: Thresholds and falloff correspond to camera near/far.\n// Example: worldDistance = distanceThreshold * (camera.far - camera.near)\nconst ssaoEffect=new SSAOEffect(camera,normalPass.texture,{blendFunction:BlendFunction.MULTIPLY,distanceScaling:true,depthAwareUpsampling:true,normalDepthBuffer,samples:9,rings:7,distanceThreshold:0.02,// Render up to a distance of ~20 world units\ndistanceFalloff:0.0025,// with an additional ~2.5 units of falloff.\nrangeThreshold:0.0003,// Occlusion proximity of ~0.3 world units\nrangeFalloff:0.0001,// with ~0.1 units of falloff.\nluminanceInfluence:0.7,minRadiusScale:0.33,radius:0.1,intensity:1.33,bias:0.025,fade:0.01,color:null,resolutionScale:1});const copyPass=new ShaderPass(new CopyMaterial());const effectPass=new EffectPass(camera,bloomEffect,smaaEffect,edgesTextureEffect,weightsTextureEffect,ssaoEffect,vignetteEffect,brightnessContrastEffect,gammaCorrectionEffect,hueSaturationEffect);composer.addPass(normalPass);if(renderer.capabilities.isWebGL2){composer.addPass(depthDownsamplingPass);}else{console.log(\"WebGL 2 not supported, falling back to naive depth downsampling\");}copyPass.enabled=false;copyPass.renderToScreen=true;effectPass.renderToScreen=true;composer.addPass(copyPass);composer.addPass(effectPass);return composer;}export default Composer;","map":{"version":3,"names":["EffectComposer","RenderPass","VignetteEffect","BrightnessContrastEffect","GammaCorrectionEffect","SMAAEffect","BloomEffect","HueSaturationEffect","NormalPass","DepthDownsamplingPass","SSAOEffect","TextureEffect","EffectPass","SMAAPreset","EdgeDetectionMode","BlendFunction","KernelSize","PredicationMode","ShaderPass","CopyMaterial","FloatType","HalfFloatType","Composer","renderer","scene","camera","smaaSearchImage","smaaAreaImage","composer","frameBufferType","renderPass","addPass","vignetteEffect","eskil","offset","darkness","brightnessContrastEffect","contrast","brightness","gammaCorrectionEffect","gamma","smaaEffect","HIGH","COLOR","edgeDetectionMaterial","setEdgeDetectionThreshold","setPredicationMode","DEPTH","setPredicationThreshold","setPredicationScale","edgesTextureEffect","blendFunction","SKIP","texture","renderTargetEdges","weightsTextureEffect","renderTargetWeights","bloomEffect","SCREEN","kernelSize","MEDIUM","luminanceThreshold","luminanceSmoothing","height","intensity","resolutionScale","hueSaturationEffect","hue","saturation","normalPass","depthDownsamplingPass","normalBuffer","normalDepthBuffer","capabilities","isWebGL2","ssaoEffect","MULTIPLY","distanceScaling","depthAwareUpsampling","samples","rings","distanceThreshold","distanceFalloff","rangeThreshold","rangeFalloff","luminanceInfluence","minRadiusScale","radius","bias","fade","color","copyPass","effectPass","console","log","enabled","renderToScreen"],"sources":["/Users/sam/Documents/CakeProject/src/components/Viewer3D/libs/Composer.js"],"sourcesContent":["import {\n  EffectComposer,\n  RenderPass,\n  VignetteEffect,\n  BrightnessContrastEffect,\n  GammaCorrectionEffect,\n  SMAAEffect,\n  BloomEffect,\n  HueSaturationEffect,\n  NormalPass,\n  DepthDownsamplingPass,\n  SSAOEffect,\n  TextureEffect,\n  EffectPass,\n  SMAAPreset,\n  EdgeDetectionMode,\n  BlendFunction,\n  KernelSize,\n  PredicationMode,\n  ShaderPass\n} from \"postprocessing\"\n\nimport {CopyMaterial} from \"./CopyMaterial\"\n\nimport {FloatType, HalfFloatType} from \"three\"\n\nfunction Composer(renderer, scene, camera, smaaSearchImage, smaaAreaImage) {\n  const composer = new EffectComposer(renderer, {\n    frameBufferType: HalfFloatType\n  })\n  const renderPass = new RenderPass(scene, camera)\n  composer.addPass(renderPass)\n  const vignetteEffect = new VignetteEffect({\n    eskil: false,\n    offset: 0.1,\n    darkness: 0.5\n  })\n  const brightnessContrastEffect = new BrightnessContrastEffect({\n    contrast: 0.05,\n    brightness: 0.0\n  })\n  const gammaCorrectionEffect = new GammaCorrectionEffect({\n    gamma: 1.6\n  })\n\n  const smaaEffect = new SMAAEffect(\n    smaaSearchImage,\n    smaaAreaImage,\n    SMAAPreset.HIGH,\n    EdgeDetectionMode.COLOR\n  )\n  smaaEffect.edgeDetectionMaterial.setEdgeDetectionThreshold(0.05)\n  smaaEffect.edgeDetectionMaterial.setPredicationMode(PredicationMode.DEPTH)\n  smaaEffect.edgeDetectionMaterial.setPredicationThreshold(0.002)\n  smaaEffect.edgeDetectionMaterial.setPredicationScale(1.0)\n\n  const edgesTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetEdges.texture\n  })\n\n  const weightsTextureEffect = new TextureEffect({\n    blendFunction: BlendFunction.SKIP,\n    texture: smaaEffect.renderTargetWeights.texture\n  })\n\n  const bloomEffect = new BloomEffect({\n    blendFunction: BlendFunction.SCREEN,\n    kernelSize: KernelSize.MEDIUM,\n    luminanceThreshold: 0.3,\n    luminanceSmoothing: 0.83,\n    height: 1024,\n    intensity: 0.5,\n    resolutionScale: 0.5\n  })\n\n  const hueSaturationEffect = new HueSaturationEffect({\n    hue: 0.0,\n    saturation: 0.191\n  })\n\n  const normalPass = new NormalPass(scene, camera)\n  const depthDownsamplingPass = new DepthDownsamplingPass({\n    normalBuffer: normalPass.texture,\n    resolutionScale: 0.5\n  })\n  const normalDepthBuffer = renderer.capabilities.isWebGL2\n    ? depthDownsamplingPass.texture\n    : null\n\n  // Note: Thresholds and falloff correspond to camera near/far.\n  // Example: worldDistance = distanceThreshold * (camera.far - camera.near)\n  const ssaoEffect = new SSAOEffect(camera, normalPass.texture, {\n    blendFunction: BlendFunction.MULTIPLY,\n    distanceScaling: true,\n    depthAwareUpsampling: true,\n    normalDepthBuffer,\n    samples: 9,\n    rings: 7,\n    distanceThreshold: 0.02, // Render up to a distance of ~20 world units\n    distanceFalloff: 0.0025, // with an additional ~2.5 units of falloff.\n    rangeThreshold: 0.0003, // Occlusion proximity of ~0.3 world units\n    rangeFalloff: 0.0001, // with ~0.1 units of falloff.\n    luminanceInfluence: 0.7,\n    minRadiusScale: 0.33,\n    radius: 0.1,\n    intensity: 1.33,\n    bias: 0.025,\n    fade: 0.01,\n    color: null,\n    resolutionScale: 1\n  })\n\n  const copyPass = new ShaderPass(new CopyMaterial())\n\n  const effectPass = new EffectPass(\n    camera,\n    bloomEffect,\n    smaaEffect,\n    edgesTextureEffect,\n    weightsTextureEffect,\n    ssaoEffect,\n    vignetteEffect,\n    brightnessContrastEffect,\n    gammaCorrectionEffect,\n    hueSaturationEffect\n  )\n\n  composer.addPass(normalPass)\n  if (renderer.capabilities.isWebGL2) {\n    composer.addPass(depthDownsamplingPass)\n  } else {\n    console.log(\n      \"WebGL 2 not supported, falling back to naive depth downsampling\"\n    )\n  }\n\n  copyPass.enabled = false\n  copyPass.renderToScreen = true\n  effectPass.renderToScreen = true\n\n  composer.addPass(copyPass)\n  composer.addPass(effectPass)\n\n  return composer\n}\n\nexport default Composer\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}